# Windows环境变量可视化管理工具

一个基于Rust和egui开发的Windows环境变量可视化管理软件，支持实时生效和友好的用户界面。

## 🎯 项目特性

- **可视化界面**：直观的环境变量管理界面
- **实时生效**：修改后立即生效（新启动的进程）
- **智能刷新**：支持自动刷新和手动触发刷新
- **配置文件管理**：支持自定义配置文件，可选择性启用/禁用
- **双级别管理**：支持用户级和系统级环境变量
- **智能搜索**：实时搜索和过滤功能
- **批量操作**：支持批量选择、删除、导出操作
- **备份恢复**：自动备份和版本管理
- **主题支持**：浅色/深色/高对比度主题

## 🏗️ 技术架构

### 技术栈
- **语言**：Rust (内存安全，高性能)
- **UI框架**：egui (原生GUI，轻量级)
- **系统API**：winapi (Windows原生API)
- **配置存储**：JSON格式

### 架构设计
```
src/
├── app/          # 应用主模块
├── ui/           # 用户界面
├── core/         # 核心逻辑
├── models/       # 数据模型
└── utils/        # 工具模块
```

## 📋 功能规划

### 核心功能 ✅
- ✅ 环境变量读取与展示
- ✅ 添加/编辑/删除环境变量
- ✅ 按作用域分类显示（用户/系统）
- ✅ 实时搜索和过滤
- ✅ 环境变量即时生效
- ✅ 自动刷新和手动刷新
- ✅ 配置文件管理（启用/禁用）
- ✅ 批量操作支持（选择、删除、导出）

### 高级功能 🚀
- ✅ 批量操作模式切换
- ✅ 手动环境刷新功能
- ✅ 详细的错误处理和用户反馈
- [ ] 备份与恢复功能
- [ ] 主题切换
- [ ] 路径变量智能编辑
- [ ] 导入导出功能


### 用户体验 🎨
- [ ] 响应式界面设计
- [ ] 操作撤销/重做
- [ ] 状态提示和错误处理
- [ ] 多语言支持

## 🔧 开发计划

### 阶段1：基础框架 (1-2周)
- [ ] 项目初始化
- [ ] Windows API封装
- [ ] 基础数据模型
- [ ] 日志系统

### 阶段2：核心功能 (2-3周)
- [ ] 环境变量读取
- [ ] 基础UI界面
- [ ] 编辑功能实现
- [ ] 错误处理

### 阶段3：高级功能 (2-3周)
- [ ] 搜索和过滤
- [ ] 批量操作
- [ ] 备份恢复
- [ ] 主题系统

### 阶段4：刷新机制 (1周)
- [ ] Windows消息广播
- [ ] 权限处理
- [ ] 用户提示

### 阶段5：测试优化 (1-2周)
- [ ] 单元测试
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 安装包制作

## 🚀 快速开始

### 环境要求
- Rust 1.70+
- Windows 10/11

### 构建项目
```bash
git clone https://github.com/yourname/windows-env-manager.git
cd windows-env-manager
cargo build --release
```

### 运行
```bash
cargo run --release
```

## 📖 使用说明

### 基础操作
1. **启动应用**：双击可执行文件
2. **查看变量**：主界面显示所有环境变量
3. **编辑变量**：双击变量或点击编辑按钮
4. **添加变量**：点击新增按钮
5. **删除变量**：选中变量后点击删除
6. **搜索**：使用顶部搜索框
7. **过滤**：使用侧边栏筛选选项

### 配置文件管理
1. **创建配置文件**：点击"配置文件"→"新建"
2. **启用/禁用配置**：配置文件列表中切换开关
3. **导入配置**：支持YAML/JSON格式配置文件导入
4. **应用配置**：一键应用整个配置文件的环境变量
5. **刷新模式**：可选择自动刷新或手动刷新

### 刷新控制
- **自动刷新**：修改后立即生效（默认启用）
- **手动刷新**：点击工具栏"刷新"按钮
- **批量刷新**：对配置文件进行批量操作后统一刷新

## 🛠️ 技术细节

### 环境变量刷新机制
支持两种刷新模式：
- **自动刷新**：修改后立即广播`WM_SETTINGCHANGE`消息
- **手动刷新**：点击刷新按钮手动触发
- **选择性刷新**：可针对特定配置文件启用/禁用刷新

### 配置文件管理
支持自定义配置文件，类似PowerToys环境变量管理器：
```yaml
# 示例配置文件
profiles:
  development:
    enabled: true
    variables:
      JAVA_HOME: "C:\Program Files\Java\jdk-11"
      MAVEN_HOME: "C:\Program Files\Apache\maven"
  production:
    enabled: false
    variables:
      NODE_ENV: "production"
      DEBUG: "false"
```
- 支持启用/禁用整个配置文件
- 支持批量启用/禁用配置组
- 支持配置文件的导入导出

### 新功能使用说明

#### 默认用户变量选择
- 应用程序启动时默认选择"User"环境变量范围
- 系统级环境变量仅供查看，不允许编辑或删除（显示为灰色只读状态）
- 移除了"All"选项以防止系统不稳定
- 新增变量时只能选择"User"范围，"System"选项已禁用

#### 删除确认机制
- 单个变量删除时会显示确认对话框，防止误操作
- 批量删除时会显示详细的确认信息，包括用户变量和系统变量的数量
- 所有删除操作都需要用户明确确认才能执行

#### 批量操作模式
1. 点击界面顶部的"Batch Mode"按钮切换到批量模式
2. 在批量模式下，变量列表会显示复选框
3. 选择需要操作的变量（系统变量会被自动跳过）
4. 使用"Delete Selected"批量删除选中的用户变量
5. 使用"Export Selected"导出选中变量的信息到日志
6. 批量删除时会自动跳过系统变量并显示相应提示
6. 界面会显示当前选中的变量数量

#### 手动刷新功能
1. 点击界面顶部的"Settings"按钮打开设置面板
2. 在设置面板中找到"Manual Refresh Environment"按钮
3. 点击该按钮手动刷新环境变量
4. 系统会显示刷新成功或失败的消息

#### 自动刷新设置
1. 在设置面板中找到"Auto Refresh"选项
2. 勾选或取消勾选来启用/禁用自动刷新
3. 设置会立即生效并保存到配置文件

### 权限要求
- 用户级变量：普通权限即可
- 系统级变量：需要管理员权限（UAC提示）
- 配置文件操作：根据配置文件作用域确定权限

## 🤝 贡献指南

欢迎贡献！请查看[CONTRIBUTING.md](CONTRIBUTING.md)了解详情。

### 开发环境设置
1. Fork本项目
2. 创建功能分支
3. 提交更改
4. 发起Pull Request

## 📄 许可证

本项目采用MIT许可证 - 查看[LICENSE](LICENSE)文件了解详情。

## 🙏 致谢

- [egui](https://github.com/emilk/egui) - 优秀的Rust GUI框架
- [winapi](https://github.com/retep998/winapi-rs) - Windows API绑定

## 📞 联系方式

- 项目地址：[GitHub Issues](https://github.com/yourname/windows-env-manager/issues)
- 邮箱：your.email@example.com

---

**⭐ 如果这个项目对你有帮助，请给个Star支持一下！**