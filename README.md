# Windows 环境变量管理器

一个现代化的 Windows 环境变量管理工具，使用 Rust 和 egui 构建，提供直观的图形界面来管理用户和系统环境变量。

## 🌟 功能特性

- **现代化界面**：采用 Material Design 设计语言，支持深色/浅色主题切换
- **智能搜索**：实时搜索和过滤环境变量
- **批量操作**：支持批量选择和删除用户变量
- **响应式设计**：自适应不同窗口尺寸
- **数据导出**：支持将变量导出到文件或剪贴板
- **安全操作**：防止误删系统变量，提供确认对话框
- **实时预览**：悬停查看变量完整值，支持变量详情面板

## 🏗️ 项目结构

项目采用模块化架构，将UI组件从主应用逻辑中分离，便于维护和扩展：

### 核心架构

```
src/
├── app/
│   ├── app.rs              # 主应用入口，协调各组件
│   ├── state.rs            # 应用状态管理
│   ├── theme.rs            # 主题和样式配置
│   └── components/         # UI组件模块
│       ├── mod.rs          # 组件导出
│       ├── header.rs       # 应用头部组件
│       ├── variable_list.rs # 变量列表组件
│       ├── batch_actions.rs # 批量操作组件
│       ├── dialogs/        # 对话框组件
│       │   ├── add_variable.rs    # 添加变量对话框
│       │   ├── delete_confirm.rs  # 删除确认对话框
│       │   └── batch_delete_confirm.rs # 批量删除确认
│       └── cards/          # 卡片组件
│           └── variable_card.rs   # 变量卡片组件
├── models/
│   └── env_variable.rs     # 环境变量数据模型
└── services/
    └── env_service.rs      # 环境变量操作服务
```

### UI组件架构

#### 1. 主应用 (`app.rs`)
- **职责**：协调各组件，管理应用生命周期
- **状态管理**：维护变量列表、搜索状态、编辑状态等
- **事件处理**：处理用户交互和组件间通信

#### 2. 头部组件 (`components/header.rs`)
- **功能**：应用标题、主题切换、搜索框、操作按钮
- **响应式**：根据窗口宽度自动调整布局
- **交互**：实时搜索、批量模式切换

#### 3. 变量列表 (`components/variable_list.rs`)
- **功能**：展示所有环境变量，支持筛选和排序
- **交互**：点击选择、双击展开详情、右键菜单
- **批量模式**：支持多选和批量操作

#### 4. 批量操作栏 (`components/batch_actions.rs`)
- **功能**：显示选中数量，提供批量删除和导出
- **状态感知**：根据选中变量类型显示不同操作
- **安全提示**：防止误删系统变量

#### 5. 对话框组件 (`components/dialogs/`)
- **添加变量**：简洁的表单界面，支持变量名验证
- **删除确认**：防止误操作，显示变量信息
- **批量删除**：显示用户/系统变量统计，确认操作

#### 6. 变量卡片 (`components/cards/variable_card.rs`)
- **视觉层次**：不同作用域使用不同颜色标识
- **交互反馈**：悬停高亮、选中状态、展开详情
- **操作按钮**：编辑、删除、复制等快捷操作

### 主题系统 (`theme.rs`)

#### 颜色配置
- **主色调**：蓝色系，用于主要操作和品牌识别
- **辅助色**：紫色系，用于次要操作和强调
- **状态色**：
  - 成功：绿色
  - 警告：黄色  
  - 错误：红色
  - 信息：蓝色

#### 视觉层次
- **卡片背景**：提供清晰的视觉分隔
- **悬停效果**：增强交互反馈
- **阴影系统**：营造立体感和层次感
- **圆角设计**：现代化柔和的视觉效果

#### 响应式设计
- **断点**：800px 以下为紧凑模式
- **布局**：水平/垂直布局自动切换
- **字体**：根据窗口大小调整字号
- **间距**：动态调整内外边距

## 🚀 快速开始

### 环境要求
- Rust 1.70 或更高版本
- Windows 10/11 操作系统

### 构建和运行

```bash
# 克隆项目
git clone <repository-url>
cd window_env_visual_control

# 构建项目
cargo build --release

# 运行应用
cargo run --release
```

### 开发模式

```bash
# 开发构建（包含调试信息）
cargo build

# 运行开发版本
cargo run

# 运行测试
cargo test
```

## 🎯 使用指南

### 基本操作

1. **查看变量**：主界面显示所有环境变量，按作用域分类
2. **搜索变量**：使用顶部搜索框实时过滤变量
3. **编辑变量**：点击变量行的编辑按钮，或双击变量值
4. **删除变量**：点击删除按钮，确认后移除（仅用户变量）
5. **复制值**：点击复制按钮将变量值复制到剪贴板

### 批量操作

1. **启用批量模式**：点击顶部"批量操作"按钮
2. **选择变量**：勾选需要操作的变量复选框
3. **批量删除**：选中用户变量后点击"删除选中"按钮
4. **批量导出**：选中变量后点击"导出选中"按钮

### 主题切换

- 点击右上角的太阳/月亮图标切换浅色/深色主题
- 主题设置会自动保存，下次启动时保持

## 🔧 开发指南

### 添加新组件

1. **创建组件文件**：在 `src/app/components/` 下新建模块
2. **定义组件结构**：实现必要的字段和方法
3. **注册组件**：在 `mod.rs` 中导出新组件
4. **集成到主应用**：在 `app.rs` 中使用新组件

### 扩展现有组件

1. **分析需求**：明确需要添加的功能或改进
2. **修改组件**：在对应组件文件中添加新功能
3. **测试验证**：确保新功能不影响现有逻辑
4. **更新文档**：同步更新相关文档说明

### 样式定制

1. **修改主题**：编辑 `src/app/theme.rs` 中的颜色配置
2. **调整布局**：在对应组件中修改响应式断点
3. **添加动画**：使用 egui 的动画系统实现平滑过渡

## 📋 API 文档

### 核心数据结构

#### EnvVariable
```rust
pub struct EnvVariable {
    pub name: String,
    pub value: String,
    pub scope: EnvScope,
}
```

#### EnvScope
```rust
pub enum EnvScope {
    User,    // 用户级变量
    System,  // 系统级变量
}
```

### 组件接口

#### AppHeader
- **输入**：搜索查询、主题状态、批量模式状态
- **输出**：用户操作事件（搜索、主题切换、批量模式等）

#### VariableList
- **输入**：变量列表、搜索条件、批量模式状态
- **输出**：变量选择、编辑、删除等事件

#### Dialog Components
- **输入**：显示状态、相关数据
- **输出**：用户确认/取消操作

## 🐛 常见问题

### Q: 无法删除系统变量？
A: 出于安全考虑，应用只允许删除用户变量。系统变量需要管理员权限操作。

### Q: 搜索不生效？
A: 检查搜索框是否为空，或尝试清除筛选条件。

### Q: 主题不生效？
A: 确保主题切换按钮正常工作，或检查配置文件权限。

### Q: 批量操作无响应？
A: 确认已选择用户变量（系统变量无法批量删除）。

## 🤝 贡献指南

1. **Fork 项目**：创建个人分支进行开发
2. **创建功能分支**：使用 `feature/` 前缀命名
3. **提交代码**：遵循 Conventional Commits 规范
4. **创建 PR**：描述清楚变更内容和测试情况
5. **代码审查**：等待维护者审查和合并

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙋‍♂️ 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 [Issue](https://github.com/your-repo/issues)
- 发送邮件到：your-email@example.com

---

**注意**：本项目专为 Windows 环境设计，在其他操作系统上可能无法正常工作。